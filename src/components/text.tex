  // For handling prediction vote
  const handlePredictionVote = async(cardId: number, votedSide: 1 | 2) => {
    try {
      // Confirm login
      const loggedIn = await isLoggedIn();
      if (!loggedIn) {
        alert('ログインしてください')
        return
      };

      // Get prediction vote data from userID
      const { data: existingVoteData, error: fetchError } = await supabase
        .from("votes")
        .select("id")
        .eq("user_id", userId)
        .eq("fight_card_id", cardId)
        .eq("vote_type", "prediction")
        .maybeSingle();

      if (fetchError) {
        console.error("Failed to fetch vote data", fetchError);
        return;
      }

      // Check if you've already voted
      if (existingVoteData) {
        // Delete prediction vote data from votes table
        const { error: deleteError } = await supabase
          .from("votes")
          .delete()
          .eq("id", existingVoteData.id);

        if (deleteError) {
          console.error("Failed to delete vote : ", deleteError);
        } else {
          // Remove the vote from votedCards state
          setVotedCards((prev) => 
            prev.filter((v) => 
              v.id !== existingVoteData.id
            )
          );
          // Update the vote counts in fightCards
          const deletedSide = votedCards.find(v => v.id === existingVoteData.id);
          setFightCards((prev) =>
            prev.map((c) =>
              c.id === cardId
                ? {
                    ...c,
                    fighter1_votes:
                      deletedSide?.vote_for === 1 ? Math.max(c.fighter1_votes - 1, 0) : c.fighter1_votes,
                    fighter2_votes:
                      deletedSide?.vote_for === 2 ? Math.max(c.fighter2_votes - 1, 0) : c.fighter2_votes,
                  }
                : c
            )
          );
        }
      } else {
        // Insert prediction vote data into votes table
        const { data: voteData, error: insertError } = await supabase
        .from("votes")
        .insert({
          user_id: userId,
          fight_card_id: cardId,
          vote_type: "prediction",
          vote_for: votedSide,
        })
        .select()
        .single();

        if (insertError) {
          if (insertError.code === "23505") {
            console.warn("already voted for this card");
          } else {
            console.error("Failed to insert vote data : ", insertError);
          }
        } else if(voteData) {
          // Add the new vote to the state
          setVotedCards((prev) => [...prev, voteData]);
          setFightCards((prev) =>
            prev.map((c) =>
              c.id === cardId
                ? {
                    ...c,
                    fighter1_votes:
                      votedSide === 1 ? c.fighter1_votes + 1 : c.fighter1_votes,
                    fighter2_votes:
                      votedSide === 2 ? c.fighter2_votes + 1 : c.fighter2_votes,
                  }
                : c
            )
          );
        }
      }
    } catch (e: unknown) {
      if (e instanceof Error) {
        console.error(e.message)
      } else {
        console.error('Unexpected error during prediction vote : ', e)
      }
    }
  }